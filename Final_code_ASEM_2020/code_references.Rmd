---
title: "Code References for ASEM Revisions"
output:
  pdf_document: default
---

```{r include=FALSE}
library(tidyverse)
library(lmtest)
library(AICcmodavg)
library(broom)
library(ggpubr)
library(lsr)
library(rstatix)
library(knitr)
library(cowplot)
library(dplyr)
library(Hmisc)
library(FactoMineR)
library(multcompView)
library(lsmeans)
```


```{r echo=FALSE}
image_recog <- read.csv("Data_cleaned_person.csv")
```


# CANFIELD CODE

The "nested" part of the experiment is a subset of all the conditions. Therefore, I'm making a new tibble that only includes the 4 relevant conditions (and excludes 5AI_ABC and Control).



Nested ANOVA is also called hierarchical ANOVA

https://www.youtube.com/watch?v=MFOOooaa32c
* Need car package
* Curdies data
    * DUGESIA: num (untransformed response var)
    * SITE: int, 6 sites -> convert to fct
    * SEASON: fct, winter/summer
    * S4DUGES: num (log4 transformed DUGESIA, actual response var)
* Check for Normality
* Different sites tested for 2 seasons, sites not repeated for second season
    * e.g. sites 1-3 for summer and 4-6 for winter
* Site is nested within season
* 2 ways
    * aov(S4DUGES~SEASON/SITE, data)
    * aov(S4DUGES~SEASON+SITE%in%SEASON, data)
* Interpretation
    * H0: No effect of Factor1 (season)
    * H0: No effect of Factor2 (site) nested in Factor1 (season)
* Evaluate residuals for heteroskedasticity
    * Residuals vs. fitted values

http://www.biostathandbook.com/nestedanova.html
* Used when you have subgroups within groups
* Tests for variation in means among/between groups + variation in means of subgroups within groups
* Subgroups are random effects
* Example:
    * TECH: fct, Janet/Brad
    * RAT: fct, 6 levels (Janet used 3 rats and Brad used 3 different rats)
    * PROTEIN: num (response var)
    * Measured protein response multiple times per rat
* If the subgroup has distinctions (e.g. male vs. female rats) -> two-way ANOVA
* Usually for a nested ANOVA, you don’t care about the differences for the subgroups
* Nested structure accounts for the fact that you have repeated measures from each rat and have violated the assumption of independence

```{r}
# Nested Anova
# REF: https://rcompanion.org/rcompanion/d_07.html
# NOTE: I don't think this is the right model (see discussion below)
# this is included for comparison

library(nlme)
model_lme = lme(exact_match_answers_as_percent ~ AI_1or5, random=~1|bar,
            data=image_recog_AI1or5,
            method="REML")



anova.lme(model_lme,
          type="sequential",
          adjustSigma = FALSE) # AI_1or5 is sig different

# Post-hoc comparison of means
library(multcomp)
posthoc = glht(model_lme,
               linfct = mcp(AI_1or5="Tukey"))
mcs = summary(posthoc,
              test=adjusted("single-step"))
mcs

# Test the significance of the random effect in the mixed effects model

```


Two Way Anova (aka Factorial Anova)
http://www.biostathandbook.com/twowayanova.html
* Example
    * ENZYME: num (response var)
    * GENOTYPE: fct, 3 levels
    * SEX: fct, 2 levels
* Have observations for male and female at each genotype level <- this is what makes it different than nested
* In order to test interaction, you need multiple observations for each sex in each genotype
* Can be used for repeated measures
* Interpretation
    * H0: No effect of Factor 1 (genotype)
    * H0: No effect of Factor 2 (sex)
    * H0: No effect of Factor 1 X Factor 2 (effect of one factor does not depend on the level of the other factor)
    * If the interaction is significant, you should also run one-way anovas for each factor level

In our experiment, each person was assigned to 1 condition and evaluated multiple images. In this stage, we are evaluating the average performance (% correct) across all the images. 
* For each level of AI_rec (1 vs. 5), there are 2 levels of bar (yes vs. no).
* Our experiment is most similar to the two-way ANOVA because we are interested in the main effect of the subgroup level.
    * The nested ANOVA is more appropriate when the factors don’t completely overlap (e.g. if we used different images for bar vs. no bar)
